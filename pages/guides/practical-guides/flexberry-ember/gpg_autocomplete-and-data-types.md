---
title: Автозаполнение полей и типы данных
sidebar: guide-practical-guides_sidebar
keywords: guide, ember-flexberry, flexberry designer, flexberry ember, диаграмма классов, приложение, автозаполнение, база данных, БД, типы данных
toc: true
permalink: ru/gpg_autocomplete-and-data-types.html
lang: ru
---

## Автозаполнение полей на формах

Частично настройка автозаполнения полей уже была выполнена при создании диаграммы классов. В частности, была указана текущая дата для атрибута CreateDate:

![Класс Document](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-1.png)

Такой синтаксис использутся для указная значения по умолчанию, которое будет использоваться в том случае, если соответствующее поле на форме редактирования не заполнено. Чаще всего такая потребность возникает при создании новой записи, у которой часть полей заполняется таким образом автоматически.

Помимо даты создания документа, при создании нового заявления или накладной потребуется также проставлять им уникальный номер и автоматически устанавливать статус “Новый” при создании. Для этого откроем список атрибутов класса “Документ”:

_`Document → [ПКМ] → ORM: Редактировать свойства → Атрибуты`_

![Дефолтное значение даты создания класса Document](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-2.png)

Здесь видим ту самую автоподстановку для поля “DateCreate”. Для настройки заполнения **поля “Number”**:

> DefaultValue → 1,  
> Autoincrement → +,  
> NotNull → + (обязательно для автоинкремента).

![Дефолтные значения полей класса Document](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-3.png)

После сохранения получим:

![Класс Document с автозаполнением](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-4.png)

{% include note.html content="Автоинкремент возможен только для полей типа int." %}

---

**_Самостоятельно_** проделайте то же для следующих классов:

**Order**

> Status ‒ New

**Invoice**

> Status ‒ New

**Storehouse**

> Number ‒ с 1, инкремент

**Product**

> ProductCode ‒ с 1, инкремент

**Employee**

> Number ‒ с 1, инкремент

---

После выполнения всех описанных шагов диаграмма классов готова к генерации в ember-приложение. Не забудьте сохранить её по окончании работы.

## Настройка вычислимых полей

Пример вычислимого поля в диаграмме классов уже есть ‒ это поле “TotalSum” (Стоимость заказа) класса Order (Заказ). Оно помечено символом “/”:

![Нехранимое поле TotalSum класса Order](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-5.png)

Данное свойство не будет храниться в БД. В нашем примере нехранимые свойства мы использовать не будем, т.к. как минимум из Накладной мы будем обращаться к подобным свойствам из кода. Поэтому проще их сохранять, чем пересчитывать каждый раз.

Сделаем свойство **TotalSum** у класса Order **хранимым**:

![Возвращение хранимости поля TotalSum класса Order](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-6.png)

## Настройка типов данных

Настройка типов данных ‒ очень важный шаг, так как от этого зависит сопоставление типов данных в коде приложения и базе данных, а также генерация правил валидации в приложении. Разберем ситуацию на примере класса Invoice (Накладная):

![Поле ShipmentDateTime класса Invoice](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-7.png)

У поля ShipmentDateTime (Дата и время отгрузки) стоит тип DateTime. Это означает, что, если при сохранении модели это поле будет пустым, то оно по умолчанию будет заполнено значением "01.01.1901”. Нас это не устраивает, так как это поле может быть пустым (не по каждой накладной может быть осуществлена отгрузка в определенный момент времени).

Это связано с тем, что в C# переменная типа DateTime не может принимать нулевые (null) значения: в момент сохранения записи происходит автоприсвоение минимального валидного значения (01.01.1901). Если требуется показать, что переменная определенного типа может принимать нулевые значения, после её типа ставится символ “?”. В нашем случае, требуется тип, преобразующийся в DateTime?.

Проверим, есть ли он среди известных Flexberry Designer типов. Для этого откроем карту типов:

_`Стадия (ember) → Ember → [ПКМ] → Свойства модели → Карта типов`_

![Свойства модели](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-8.png)

![Карта типов модели](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-9.png)

Можем увидеть, что здесь есть три типа, объявленных как Nullable: для даты, целого и вещественного чисел. Их можно использовать для решения подобной задачи, но, во-первых, не всегда необходимые Nullable-типы будут существовать в карте типов, а, во-вторых, всё-таки рекомендуется использовать стандартные типы языка C#, которые допускают значение null. Поэтому, на примере текущей ситуации разберем, как использовать свой собственный тип.

**Добавим** для новых типов собственную **диаграмму классов (Типы данных)**:

![Создание диаграммы классов "Типы данных"](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-10.png)

В ней создадим **новый класс** с **именем tDateTime** и **стереотипом "typedef"** (его можно сразу свернуть, т.к. у него не будет никаких атрибутов и методов):

![Создание типа данных tDateTime](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-11.png)

Теперь нужно определить, каким типам наш новый тип будет сопоставляться при генерации приложения. Для этого перейдем снова к карте типов:

_`Стадия (ember) → [ПКМ] → Ember → Свойства модели → Карта типов`_

![Карта типов модели с тпом tDateTime(/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-12.png)

Тут уже присутствует добавленный нами тип. Назначим ему значение “отображается в” **System.DateTime?**. Поле “файл со сборкой” оставим пустым (т.к. данный тип системный и не требует дополнительных указаний).

{% include important.html content="Не забудьте сохранить свойства модели!" %}

То же нужно сделать и для **базы данных** (тип **TIMESTAMP(3)**):

_`Стадия (ember) → [ПКМ] → Ember → Storage → PostgreSQL → Настройка БД → Карта типов`_

![Карта типов БД](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-13.png)

Осталось только заменить типы данных в диаграмме классов:

![Карта типов БД](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-14.png)

{% include note.html content="Мы можем не заменять тип данных у CreateDate, т.к. этот атрибут по умолчанию заполняется текущей датой." %}

## Итог

В результате всех произведенных действий, диаграмма классов подготовлена к генерации: настроены заголовки, порядок полей, отображаемость и т.д. Прочие изменения будем производить уже в сгенерированном приложении:

![Диаграмма классов "Сущности"](/images/pages/guides/flexberry-ember/2-3-autocomplete-and-data-types/2-3-15.png)

## Перейти

- [Практическое руководство «Делай как я»](gpg_landing-page.html) <i class="fa fa-arrow-up" aria-hidden="true"></i>
- [Настройка представлений для форм](gpg_customize-forms.html) <i class="fa fa-arrow-left" aria-hidden="true"></i>
- [Генерация Ember-приложения](gpg_ember-application-generation.html) <i class="fa fa-arrow-right" aria-hidden="true"></i>
